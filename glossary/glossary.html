<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description"
            content="Glossar: Generative KI und Large Language Models - Summer School by Dr. Christopher Pollin">
        <title>Glossar - LLM Summer School for DH</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="../assets/style.css">
        <style>
            /* ========================================
               GLOSSARY V2 - CLEANER, BOLDER DESIGN
               ======================================== */

            :root {
                --primary: #2c5aa0;
                --primary-light: #4d7bc7;
                --text: #1a1a1a;
                --text-muted: #666;
                --bg-warm: #fafafa;
                --bg-card: #ffffff;
                --border: #e0e0e0;
                --level-basic: #2e7d32;
                --level-intermediate: #e65100;
                --level-advanced: #1565c0;
            }

            /* ========================================
               HERO - Matching main site style
               ======================================== */
            .glossary-hero {
                background-color: #f9f9f9;
                padding: 120px 0 50px;
                color: var(--text);
            }

            .glossary-hero h1 {
                font-size: 2.5em;
                margin-bottom: 0.3em;
                font-family: Georgia, 'Times New Roman', serif;
                font-weight: normal;
            }

            .glossary-hero .subtitle {
                color: var(--text-muted);
                font-size: 1.1em;
                margin-bottom: 30px;
                font-style: italic;
            }

            /* Search in Hero */
            .hero-search {
                max-width: 500px;
                margin: 0 auto;
                position: relative;
            }

            .hero-search input {
                width: 100%;
                padding: 14px 20px 14px 48px;
                font-size: 1em;
                border: 1px solid var(--border);
                border-radius: 6px;
                background: white;
                color: var(--text);
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            }

            .hero-search input::placeholder {
                color: #999;
            }

            .hero-search input:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 2px 12px rgba(44, 90, 160, 0.15);
            }

            .hero-search svg {
                position: absolute;
                left: 16px;
                top: 50%;
                transform: translateY(-50%);
                width: 18px;
                height: 18px;
                color: #999;
            }

            .search-hint {
                margin-top: 12px;
                font-size: 0.85em;
                color: var(--text-muted);
            }

            .search-hint kbd {
                background: #e0e0e0;
                padding: 2px 6px;
                border-radius: 3px;
                font-family: inherit;
                font-size: 0.9em;
            }

            /* ========================================
               MAIN LAYOUT - Two columns
               ======================================== */
            .glossary-layout {
                display: grid;
                grid-template-columns: 220px 1fr;
                gap: 0;
                min-height: calc(100vh - 200px);
            }

            /* ========================================
               LEFT SIDEBAR - Navigation
               ======================================== */
            .glossary-nav {
                background: var(--bg-warm);
                border-right: 1px solid var(--border);
                padding: 30px 20px;
                position: sticky;
                top: 70px;
                height: calc(100vh - 70px);
                overflow-y: auto;
            }

            .nav-section {
                margin-bottom: 30px;
            }

            .nav-section h3 {
                font-size: 0.7em;
                text-transform: uppercase;
                letter-spacing: 1.5px;
                color: var(--text-muted);
                margin-bottom: 12px;
                font-weight: 600;
            }

            /* Alphabet Grid */
            .alpha-grid {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 4px;
            }

            .alpha-btn {
                aspect-ratio: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.85em;
                font-weight: 600;
                color: var(--text);
                background: white;
                border: 1px solid var(--border);
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.15s ease;
                text-decoration: none;
            }

            .alpha-btn:hover {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
                transform: scale(1.05);
            }

            .alpha-btn.disabled {
                color: #cbd5e0;
                background: transparent;
                border-color: transparent;
                cursor: default;
            }

            .alpha-btn.disabled:hover {
                transform: none;
                background: transparent;
                color: #cbd5e0;
            }

            .alpha-btn.active {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }

            /* Category List */
            .category-list {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            .category-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 12px;
                font-size: 0.9em;
                color: var(--text);
                background: white;
                border: 1px solid var(--border);
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .category-item:hover {
                border-color: var(--primary);
                color: var(--primary);
            }

            .category-item.active {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }

            .category-item .count {
                font-size: 0.8em;
                opacity: 0.6;
            }

            /* Level Filters */
            .level-list {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }

            .level-item {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 8px 10px;
                font-size: 0.85em;
                color: var(--text);
                background: white;
                border: 1px solid var(--border);
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .level-item:hover {
                border-color: var(--primary-light);
            }

            .level-item.active {
                border-color: var(--primary);
                background: #f7fafc;
            }

            .level-dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                flex-shrink: 0;
            }

            .level-dot.basic { background: var(--level-basic); }
            .level-dot.intermediate { background: var(--level-intermediate); }
            .level-dot.advanced { background: var(--level-advanced); }

            .level-item span:last-child {
                margin-left: auto;
                opacity: 0.5;
                font-size: 0.85em;
            }

            /* Language Toggle */
            .lang-toggle {
                display: flex;
                background: white;
                border: 1px solid var(--border);
                border-radius: 6px;
                overflow: hidden;
            }

            .lang-btn {
                flex: 1;
                padding: 8px;
                font-size: 0.85em;
                border: none;
                background: transparent;
                cursor: pointer;
                transition: all 0.15s ease;
                color: var(--text-muted);
            }

            .lang-btn.active {
                background: var(--primary);
                color: white;
            }

            /* ========================================
               MAIN CONTENT AREA
               ======================================== */
            .glossary-content {
                padding: 40px 50px;
                background: white;
            }

            /* Stats Bar */
            .stats-bar {
                display: flex;
                align-items: center;
                gap: 20px;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 1px solid var(--border);
            }

            .stat {
                display: flex;
                align-items: baseline;
                gap: 6px;
            }

            .stat-value {
                font-size: 1.8em;
                font-weight: 700;
                color: var(--primary);
            }

            .stat-label {
                font-size: 0.85em;
                color: var(--text-muted);
            }

            /* ========================================
               LETTER SECTIONS
               ======================================== */
            .letter-section {
                margin-bottom: 50px;
                scroll-margin-top: 90px;
            }

            .letter-heading {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
            }

            .letter-char {
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5em;
                font-weight: normal;
                color: white;
                background: var(--primary);
                border-radius: 50%;
                font-family: Georgia, serif;
            }

            .letter-meta {
                color: var(--text-muted);
                font-size: 0.9em;
            }

            /* ========================================
               GLOSSARY CARDS - Clean & Readable
               ======================================== */
            .term-card {
                background: var(--bg-card);
                border: 1px solid var(--border);
                border-radius: 10px;
                margin-bottom: 16px;
                transition: all 0.2s ease;
                overflow: hidden;
                scroll-margin-top: 90px;
            }

            .term-card:hover {
                border-color: #cbd5e0;
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            }

            .term-card.expanded {
                border-color: var(--primary-light);
                box-shadow: 0 4px 20px rgba(44, 82, 130, 0.1);
            }

            /* Card Header */
            .term-header {
                display: flex;
                align-items: flex-start;
                gap: 15px;
                padding: 20px 24px;
                cursor: pointer;
            }

            .term-header:hover {
                background: #fafafa;
            }

            .term-title-group {
                flex: 1;
            }

            .term-title {
                font-size: 1.2em;
                font-weight: 600;
                color: var(--text);
                margin: 0 0 4px 0;
                line-height: 1.3;
            }

            .term-title-en {
                font-size: 0.85em;
                color: var(--text-muted);
                font-style: italic;
            }

            .term-level {
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 0.7em;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                flex-shrink: 0;
            }

            .term-level.basic {
                background: #c6f6d5;
                color: #276749;
            }

            .term-level.intermediate {
                background: #feebc8;
                color: #c05621;
            }

            .term-level.advanced {
                background: #e9d8fd;
                color: #553c9a;
            }

            .expand-toggle {
                width: 28px;
                height: 28px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--text-muted);
                transition: transform 0.2s ease;
                flex-shrink: 0;
            }

            .term-card.expanded .expand-toggle {
                transform: rotate(180deg);
            }

            /* Card Preview */
            .term-preview {
                padding: 0 24px 20px;
                color: #444;
                font-size: 0.95em;
                line-height: 1.6;
            }

            /* Card Body (Expanded) */
            .term-body {
                display: none;
                padding: 24px;
                background: #f8fafc;
                border-top: 1px solid var(--border);
            }

            .term-card.expanded .term-body {
                display: block;
            }

            .term-card.expanded .term-preview {
                display: none;
            }

            .term-definition {
                font-size: 1em;
                line-height: 1.8;
                color: var(--text);
                margin-bottom: 20px;
            }

            .term-definition p {
                margin-bottom: 1em;
            }

            .term-definition p:last-child {
                margin-bottom: 0;
            }

            /* Links within definitions */
            .term-link {
                color: var(--primary-light);
                text-decoration: none;
                border-bottom: 1px solid var(--primary-light);
                transition: all 0.15s ease;
            }

            .term-link:hover {
                color: var(--accent);
                border-color: var(--accent);
            }

            /* Tags - Minimal inline style */
            .term-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                margin-top: 16px;
            }

            .term-tag {
                padding: 3px 8px;
                background: transparent;
                border: 1px solid #ddd;
                border-radius: 3px;
                font-size: 0.75em;
                color: #888;
            }

            /* Sources - Compact inline style */
            .term-sources {
                margin-top: 16px;
                padding-top: 12px;
                border-top: 1px solid #eee;
            }

            .term-sources h4 {
                font-size: 0.75em;
                font-weight: 500;
                color: #999;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 6px;
            }

            .term-sources ul {
                margin: 0;
                padding: 0;
                list-style: none;
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }

            .term-sources li {
                font-size: 0.8em;
                color: var(--text-muted);
                line-height: 1.4;
            }

            .term-sources li::before {
                content: none;
            }

            .term-sources a {
                color: var(--primary-light);
                word-break: break-word;
            }

            .term-sources a:hover {
                text-decoration: underline;
            }

            /* Source Icons */
            .term-sources .source-icon {
                margin-right: 6px;
                width: 14px;
                text-align: center;
                display: inline-block;
            }

            .term-sources .source-icon.youtube { color: #FF0000; }
            .term-sources .source-icon.arxiv { color: #B31B1B; }
            .term-sources .source-icon.github { color: #333; }
            .term-sources .source-icon.book { color: #8B4513; }
            .term-sources .source-icon.paper { color: #2c5aa0; }
            .term-sources .source-icon.web { color: #666; }

            /* Related Terms - Compact style */
            .term-related {
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px solid #eee;
            }

            .term-related h4 {
                font-size: 0.75em;
                font-weight: 500;
                color: #999;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 8px;
            }

            .related-links {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
            }

            .related-link {
                padding: 4px 10px;
                background: #f5f5f5;
                border: none;
                border-radius: 4px;
                font-size: 0.8em;
                color: var(--primary);
                text-decoration: none;
                transition: all 0.15s ease;
            }

            .related-link:hover {
                background: var(--primary);
                color: white;
            }

            /* ========================================
               RESPONSIVE
               ======================================== */
            @media (max-width: 1024px) {
                .glossary-layout {
                    grid-template-columns: 1fr;
                }

                .glossary-nav {
                    position: static;
                    height: auto;
                    border-right: none;
                    border-bottom: 1px solid var(--border);
                    padding: 20px;
                }

                .nav-section {
                    margin-bottom: 20px;
                }

                .alpha-grid {
                    grid-template-columns: repeat(13, 1fr);
                }

                .category-list {
                    flex-direction: row;
                    flex-wrap: wrap;
                }

                .category-item {
                    flex: 0 0 auto;
                }

                .level-list {
                    flex-direction: row;
                }

                .glossary-content {
                    padding: 30px 20px;
                }
            }

            @media (max-width: 768px) {
                .glossary-hero {
                    padding: 100px 0 40px;
                }

                .glossary-hero h1 {
                    font-size: 2em;
                }

                .alpha-grid {
                    grid-template-columns: repeat(9, 1fr);
                }

                .term-header {
                    padding: 16px;
                }

                .term-title {
                    font-size: 1.1em;
                }

                .letter-char {
                    width: 40px;
                    height: 40px;
                    font-size: 1.2em;
                }

                .stats-bar {
                    flex-wrap: wrap;
                    gap: 15px;
                }
            }

            @media (max-width: 480px) {
                .alpha-grid {
                    grid-template-columns: repeat(7, 1fr);
                }

                .term-level {
                    font-size: 0.65em;
                    padding: 4px 8px;
                }
            }

            /* ========================================
               LOADING STATE
               ======================================== */
            .loading-state {
                text-align: center;
                padding: 60px 20px;
                color: var(--text-muted);
            }

            .loading-state p {
                font-size: 1.1em;
            }

            /* ========================================
               PRINT
               ======================================== */
            @media print {
                .glossary-nav,
                .glossary-hero,
                .expand-toggle,
                .stats-bar {
                    display: none !important;
                }

                .glossary-layout {
                    display: block;
                }

                .term-card {
                    break-inside: avoid;
                    border: 1px solid #ccc;
                    margin-bottom: 20px;
                }

                .term-body {
                    display: block !important;
                }

                .term-preview {
                    display: none !important;
                }
            }
        </style>
    </head>
    <body>
        <!-- Header -->
        <header class="site-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <a href="http://dhcraft.org/" target="_blank" rel="noopener noreferrer">
                            <img src="../assets/img/dhcraft-logo.png"
                                alt="Digital Humanities Craft OG Logo" width="40" height="40">
                        </a>
                    </div>
                    <h1 class="site-title">LLM Summer School for DH</h1>
                    <nav class="main-nav" role="navigation" aria-label="Main navigation">
                        <a href="../index.html#fundamentals">Fundamentals</a>
                        <a href="../index.html#prompt-engineering">Prompt Engineering</a>
                        <a href="../index.html#digital-editions">Digital Editions</a>
                        <a href="glossary.html" class="active">Glossary</a>
                        <a href="../index.html#contact">Contact</a>
                    </nav>
                    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">&#9776;</button>
                </div>
            </div>
        </header>

        <!-- Compact Hero with Search -->
        <section class="glossary-hero">
            <div class="container" style="text-align: center;">
                <h1>Glossar</h1>
                <p class="subtitle">Konzepte & Terminologie der Generativen KI</p>
                <div class="hero-search">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" id="search" placeholder="Begriff suchen..." aria-label="Glossar durchsuchen">
                </div>
                <p class="search-hint"><kbd>Ctrl</kbd> + <kbd>K</kbd> zum Suchen</p>
            </div>
        </section>

        <!-- Main Layout -->
        <div class="glossary-layout">

            <!-- Left Navigation -->
            <nav class="glossary-nav">

                <!-- Language -->
                <div class="nav-section">
                    <h3>Sprache</h3>
                    <div class="lang-toggle">
                        <button class="lang-btn active">DE</button>
                        <button class="lang-btn">EN</button>
                    </div>
                </div>

                <!-- Alphabet -->
                <div class="nav-section">
                    <h3>Alphabet</h3>
                    <div class="alpha-grid">
                        <a href="#letter-A" class="alpha-btn">A</a>
                        <a href="#letter-B" class="alpha-btn">B</a>
                        <a href="#letter-C" class="alpha-btn">C</a>
                        <a href="#letter-D" class="alpha-btn disabled">D</a>
                        <a href="#letter-E" class="alpha-btn">E</a>
                        <a href="#letter-F" class="alpha-btn">F</a>
                        <a href="#letter-G" class="alpha-btn">G</a>
                        <a href="#letter-H" class="alpha-btn">H</a>
                        <a href="#letter-I" class="alpha-btn">I</a>
                        <a href="#letter-J" class="alpha-btn">J</a>
                        <a href="#letter-K" class="alpha-btn disabled">K</a>
                        <a href="#letter-L" class="alpha-btn">L</a>
                        <a href="#letter-M" class="alpha-btn">M</a>
                        <a href="#letter-N" class="alpha-btn">N</a>
                        <a href="#letter-O" class="alpha-btn">O</a>
                        <a href="#letter-P" class="alpha-btn">P</a>
                        <a href="#letter-Q" class="alpha-btn">Q</a>
                        <a href="#letter-R" class="alpha-btn">R</a>
                        <a href="#letter-S" class="alpha-btn">S</a>
                        <a href="#letter-T" class="alpha-btn">T</a>
                        <a href="#letter-U" class="alpha-btn disabled">U</a>
                        <a href="#letter-V" class="alpha-btn">V</a>
                        <a href="#letter-W" class="alpha-btn">W</a>
                        <a href="#letter-X" class="alpha-btn disabled">X</a>
                        <a href="#letter-Y" class="alpha-btn disabled">Y</a>
                        <a href="#letter-Z" class="alpha-btn disabled">Z</a>
                    </div>
                </div>

                <!-- Categories -->
                <div class="nav-section">
                    <h3>Kategorien</h3>
                    <div class="category-list">
                        <div class="category-item active">
                            <span>Alle</span>
                            <span class="count">63</span>
                        </div>
                        <div class="category-item">
                            <span>Grundlagen</span>
                            <span class="count">12</span>
                        </div>
                        <div class="category-item">
                            <span>Architektur</span>
                            <span class="count">9</span>
                        </div>
                        <div class="category-item">
                            <span>Training</span>
                            <span class="count">11</span>
                        </div>
                        <div class="category-item">
                            <span>Prompting</span>
                            <span class="count">10</span>
                        </div>
                        <div class="category-item">
                            <span>AI Engineering</span>
                            <span class="count">8</span>
                        </div>
                        <div class="category-item">
                            <span>Agents</span>
                            <span class="count">6</span>
                        </div>
                        <div class="category-item">
                            <span>Safety</span>
                            <span class="count">7</span>
                        </div>
                    </div>
                </div>

                <!-- Level -->
                <div class="nav-section">
                    <h3>Schwierigkeit</h3>
                    <div class="level-list">
                        <div class="level-item active" data-level="basic">
                            <span class="level-dot basic"></span>
                            <span>Basic</span>
                            <span>0</span>
                        </div>
                        <div class="level-item active" data-level="intermediate">
                            <span class="level-dot intermediate"></span>
                            <span>Intermediate</span>
                            <span>0</span>
                        </div>
                        <div class="level-item active" data-level="advanced">
                            <span class="level-dot advanced"></span>
                            <span>Advanced</span>
                            <span>0</span>
                        </div>
                    </div>
                </div>

            </nav>

            <!-- Main Content -->
            <main class="glossary-content">

                <!-- Stats -->
                <div class="stats-bar">
                    <div class="stat">
                        <span class="stat-value" id="stat-terms">0</span>
                        <span class="stat-label">Begriffe</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="stat-categories">0</span>
                        <span class="stat-label">Kategorien</span>
                    </div>
                </div>

                <!-- Dynamic content container -->
                <div id="glossary-entries">
                    <div class="loading-state">
                        <p>Glossar wird geladen...</p>
                    </div>
                </div>

            </main>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="contact-info">
                        <h3>Contact</h3>
                        <p><strong>Dr. Christopher Pollin</strong><br>
                        Digital Humanities Craft OG<br>
                        <a href="mailto:christopher.pollin@dhcraft.org">christopher.pollin@dhcraft.org</a></p>
                    </div>
                    <div class="footer-logo">
                        <img src="../assets/img/dhcraft-logo-inverse.png" alt="DHCraft Logo" width="50" height="50">
                        <p><a href="http://dhcraft.org/">dhcraft.org</a></p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 Digital Humanities Craft OG · <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></p>
                </div>
            </div>
        </footer>

        <script src="../assets/script.js"></script>
        <script>
            // ========================================
            // GLOSSARY ENGINE - Dynamic Markdown Parser
            // ========================================

            const GlossaryApp = {
                entries: [],
                allTags: new Set(),
                currentLang: 'de',
                activeFilters: {
                    search: '',
                    category: 'all',
                    levels: new Set(['basic', 'intermediate', 'advanced'])
                },

                // Initialize the application
                async init() {
                    await this.loadGlossary();
                    this.setupEventListeners();
                    this.handleUrlHash();
                },

                // Load and parse glossary markdown
                async loadGlossary() {
                    const filename = this.currentLang === 'de' ? 'glossar_de.md' : 'glossary_en.md';

                    try {
                        const response = await fetch(filename);
                        if (!response.ok) throw new Error(`Failed to load ${filename}`);

                        const markdown = await response.text();
                        this.entries = this.parseMarkdown(markdown);
                        this.updateUI();
                    } catch (error) {
                        console.error('Error loading glossary:', error);
                        document.getElementById('glossary-entries').innerHTML =
                            '<div class="loading-state"><p>Fehler beim Laden des Glossars.</p></div>';
                    }
                },

                // Parse markdown into structured entries
                parseMarkdown(markdown) {
                    const entries = [];
                    const blocks = markdown.split(/\n(?=## )/);

                    blocks.forEach(block => {
                        if (!block.trim() || !block.startsWith('## ')) return;
                        if (block.startsWith('## Ressourcen') || block.startsWith('# ')) return;

                        const lines = block.split('\n');
                        const entry = {
                            title: lines[0].replace(/^## /, '').trim(),
                            id: '',
                            en: '',
                            tags: [],
                            level: 'basic',
                            body: '',
                            sources: []
                        };

                        let bodyStart = 1;

                        // Parse metadata
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();

                            if (line.startsWith('id:')) {
                                entry.id = line.replace('id:', '').trim();
                            } else if (line.startsWith('en:')) {
                                entry.en = line.replace('en:', '').trim();
                            } else if (line.startsWith('tags:')) {
                                entry.tags = line.replace('tags:', '').split(',').map(t => t.trim());
                                entry.tags.forEach(tag => this.allTags.add(tag));
                            } else if (line.startsWith('level:')) {
                                entry.level = line.replace('level:', '').trim();
                            } else if (line === '') {
                                bodyStart = i + 1;
                                break;
                            }
                        }

                        // Parse body and sources
                        const remaining = lines.slice(bodyStart);
                        const bodyLines = [];
                        const sourceLines = [];

                        remaining.forEach(line => {
                            if (line.trim().startsWith('* ')) {
                                sourceLines.push(line.trim().substring(2));
                            } else if (line.trim() && !line.startsWith('#')) {
                                bodyLines.push(line.trim());
                            }
                        });

                        entry.body = bodyLines.join('\n\n');
                        entry.sources = sourceLines;

                        if (entry.id && entry.title) {
                            entries.push(entry);
                        }
                    });

                    // Sort alphabetically
                    return entries.sort((a, b) => a.title.localeCompare(b.title, 'de'));
                },

                // Update the entire UI
                updateUI() {
                    this.renderEntries();
                    this.updateStats();
                    this.updateAlphabet();
                    this.updateCategories();
                    this.updateLevels();
                },

                // Render filtered entries grouped by letter
                renderEntries() {
                    const container = document.getElementById('glossary-entries');
                    const filtered = this.getFilteredEntries();

                    if (filtered.length === 0) {
                        container.innerHTML = '<div class="loading-state"><p>Keine Einträge gefunden.</p></div>';
                        return;
                    }

                    // Group by first letter
                    const grouped = {};
                    filtered.forEach(entry => {
                        const letter = entry.title.charAt(0).toUpperCase();
                        if (!grouped[letter]) grouped[letter] = [];
                        grouped[letter].push(entry);
                    });

                    let html = '';
                    Object.keys(grouped).sort().forEach(letter => {
                        html += this.renderLetterSection(letter, grouped[letter]);
                    });

                    container.innerHTML = html;

                    // Add click handlers for expand/collapse
                    container.querySelectorAll('.term-header').forEach(header => {
                        header.addEventListener('click', () => {
                            header.closest('.term-card').classList.toggle('expanded');
                        });
                    });
                },

                // Render a letter section with entries
                renderLetterSection(letter, entries) {
                    return `
                        <section class="letter-section" id="letter-${letter}">
                            <div class="letter-heading">
                                <div class="letter-char">${letter}</div>
                                <div class="letter-meta">${entries.length} ${entries.length === 1 ? 'Begriff' : 'Begriffe'}</div>
                            </div>
                            ${entries.map(e => this.renderEntryCard(e)).join('')}
                        </section>
                    `;
                },

                // Render a single entry card
                renderEntryCard(entry) {
                    const preview = this.getPreview(entry.body);
                    const bodyHtml = this.formatBody(entry.body, entry.id);
                    const sourcesHtml = entry.sources.length > 0 ? `
                        <div class="term-sources">
                            <h4>Quellen</h4>
                            <ul>
                                ${entry.sources.map(s => `<li>${this.formatSource(s)}</li>`).join('')}
                            </ul>
                        </div>
                    ` : '';

                    const relatedTerms = this.findRelatedTerms(entry);
                    const relatedHtml = relatedTerms.length > 0 ? `
                        <div class="term-related">
                            <h4>Verwandte Begriffe</h4>
                            <div class="related-links">
                                ${relatedTerms.map(r => `<a href="#${r.id}" class="related-link">${r.title}</a>`).join('')}
                            </div>
                        </div>
                    ` : '';

                    return `
                        <article class="term-card" id="${entry.id}">
                            <div class="term-header">
                                <div class="term-title-group">
                                    <h3 class="term-title">${entry.title}</h3>
                                    ${entry.en ? `<span class="term-title-en">${entry.en}</span>` : ''}
                                </div>
                                <span class="term-level ${entry.level}">${this.capitalizeFirst(entry.level)}</span>
                                <div class="expand-toggle">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                            </div>
                            <p class="term-preview">${preview}</p>
                            <div class="term-body">
                                <div class="term-definition">${bodyHtml}</div>
                                <div class="term-tags">
                                    ${entry.tags.map(t => `<span class="term-tag">${t}</span>`).join('')}
                                </div>
                                ${sourcesHtml}
                                ${relatedHtml}
                            </div>
                        </article>
                    `;
                },

                // Get preview text (first 2 sentences or ~250 chars)
                getPreview(body) {
                    const text = body.replace(/\[\[#[^\]]+\|([^\]]+)\]\]/g, '$1')
                                     .replace(/\[\[#([^\]]+)\]\]/g, '$1')
                                     .replace(/\*\*([^*]+)\*\*/g, '$1')
                                     .replace(/_([^_]+)_/g, '$1');

                    // Split into sentences and take first 2
                    const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
                    let preview = sentences.slice(0, 2).join(' ').trim();

                    // If still too short, add more; if too long, truncate
                    if (preview.length > 300) {
                        preview = preview.substring(0, 280).trim() + '...';
                    } else if (preview.length < 80 && sentences.length > 2) {
                        preview = sentences.slice(0, 3).join(' ').trim();
                    }

                    return preview || text.substring(0, 200) + '...';
                },

                // Format body text with links and styling
                formatBody(body, currentEntryId = '') {
                    let html = body
                        // Convert [[#id|text]] to links (skip self-references)
                        .replace(/\[\[#([^\]|]+)\|([^\]]+)\]\]/g, (match, id, text) => {
                            if (id === currentEntryId) return text; // No link for self-reference
                            return `<a href="#${id}" class="term-link">${text}</a>`;
                        })
                        // Convert [[#id]] to links (skip self-references)
                        .replace(/\[\[#([^\]]+)\]\]/g, (match, id) => {
                            const entry = this.entries.find(e => e.id === id || e.title.toLowerCase() === id.toLowerCase());
                            const text = entry ? entry.title : id;
                            // Skip self-references
                            if (entry && entry.id === currentEntryId) return text;
                            if (id === currentEntryId) return text;
                            return `<a href="#${id}" class="term-link">${text}</a>`;
                        })
                        // Bold text
                        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                        // Italic text
                        .replace(/_([^_]+)_/g, '<em>$1</em>')
                        // Paragraphs
                        .split('\n\n')
                        .map(p => `<p>${p}</p>`)
                        .join('');

                    return html;
                },

                // Format source citations with icons
                formatSource(source) {
                    // Determine icon based on URL or content
                    let icon = '';
                    const lowerSource = source.toLowerCase();

                    if (lowerSource.includes('youtube.com') || lowerSource.includes('youtu.be')) {
                        icon = '<i class="fab fa-youtube source-icon youtube"></i>';
                    } else if (lowerSource.includes('arxiv.org') || lowerSource.includes('arxiv.')) {
                        icon = '<i class="fas fa-file-alt source-icon arxiv"></i>';
                    } else if (lowerSource.includes('github.com') || lowerSource.includes('github.io')) {
                        icon = '<i class="fab fa-github source-icon github"></i>';
                    } else if (lowerSource.includes('deeplearningbook') || lowerSource.includes('mit press') || lowerSource.includes('_book_') || source.includes('MIT Press') || source.includes('Springer') || source.includes('O\'Reilly')) {
                        icon = '<i class="fas fa-book source-icon book"></i>';
                    } else if (lowerSource.includes('doi.org') || lowerSource.includes('acm.org') || lowerSource.includes('ieee.org') || lowerSource.includes('aclanthology') || lowerSource.includes('proceedings') || lowerSource.includes('journal') || lowerSource.includes('conference')) {
                        icon = '<i class="fas fa-scroll source-icon paper"></i>';
                    } else {
                        icon = '<i class="fas fa-link source-icon web"></i>';
                    }

                    // Convert markdown links to HTML and prepend icon
                    const formatted = source.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
                    return icon + formatted;
                },

                // Find related terms based on shared tags
                findRelatedTerms(entry, max = 4) {
                    return this.entries
                        .filter(e => e.id !== entry.id)
                        .map(e => ({
                            entry: e,
                            score: e.tags.filter(t => entry.tags.includes(t)).length
                        }))
                        .filter(r => r.score > 0)
                        .sort((a, b) => b.score - a.score)
                        .slice(0, max)
                        .map(r => r.entry);
                },

                // Get filtered entries based on current filters
                getFilteredEntries() {
                    return this.entries.filter(entry => {
                        // Search filter
                        if (this.activeFilters.search) {
                            const search = this.activeFilters.search.toLowerCase();
                            const match = entry.title.toLowerCase().includes(search) ||
                                         entry.en.toLowerCase().includes(search) ||
                                         entry.body.toLowerCase().includes(search) ||
                                         entry.tags.some(t => t.toLowerCase().includes(search));
                            if (!match) return false;
                        }

                        // Category filter
                        if (this.activeFilters.category !== 'all') {
                            if (!entry.tags.includes(this.activeFilters.category)) return false;
                        }

                        // Level filter
                        if (!this.activeFilters.levels.has(entry.level)) return false;

                        return true;
                    });
                },

                // Update statistics
                updateStats() {
                    const filtered = this.getFilteredEntries();
                    document.getElementById('stat-terms').textContent = filtered.length;
                    document.getElementById('stat-categories').textContent = this.allTags.size;
                },

                // Update alphabet navigation
                updateAlphabet() {
                    const usedLetters = new Set(this.entries.map(e => e.title.charAt(0).toUpperCase()));

                    document.querySelectorAll('.alpha-btn').forEach(btn => {
                        const letter = btn.textContent.trim();
                        if (usedLetters.has(letter)) {
                            btn.classList.remove('disabled');
                            btn.href = `#letter-${letter}`;
                        } else {
                            btn.classList.add('disabled');
                            btn.removeAttribute('href');
                        }
                    });
                },

                // Update category list
                updateCategories() {
                    const container = document.querySelector('.category-list');
                    const tagCounts = {};

                    this.entries.forEach(entry => {
                        entry.tags.forEach(tag => {
                            tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                        });
                    });

                    const sortedTags = Object.entries(tagCounts)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 8);

                    let html = `
                        <div class="category-item active" data-category="all">
                            <span>Alle</span>
                            <span class="count">${this.entries.length}</span>
                        </div>
                    `;

                    sortedTags.forEach(([tag, count]) => {
                        html += `
                            <div class="category-item" data-category="${tag}">
                                <span>${this.capitalizeFirst(tag)}</span>
                                <span class="count">${count}</span>
                            </div>
                        `;
                    });

                    container.innerHTML = html;

                    // Re-attach event listeners
                    container.querySelectorAll('.category-item').forEach(item => {
                        item.addEventListener('click', () => {
                            container.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                            item.classList.add('active');
                            this.activeFilters.category = item.dataset.category;
                            this.renderEntries();
                            this.updateStats();
                        });
                    });
                },

                // Update level filters
                updateLevels() {
                    const levelCounts = { basic: 0, intermediate: 0, advanced: 0 };
                    this.entries.forEach(e => levelCounts[e.level]++);

                    document.querySelectorAll('.level-item').forEach(item => {
                        const level = item.dataset.level;
                        const countEl = item.querySelector('span:last-child');
                        if (countEl && levelCounts[level] !== undefined) {
                            countEl.textContent = levelCounts[level];
                        }
                    });
                },

                // Setup event listeners
                setupEventListeners() {
                    // Search input
                    const searchInput = document.getElementById('search');
                    let searchTimeout;
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.activeFilters.search = e.target.value;
                            this.renderEntries();
                            this.updateStats();
                        }, 200);
                    });

                    // Keyboard shortcut for search
                    document.addEventListener('keydown', (e) => {
                        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                            e.preventDefault();
                            searchInput.focus();
                        }
                    });

                    // Level filters
                    document.querySelectorAll('.level-item').forEach(item => {
                        item.addEventListener('click', () => {
                            item.classList.toggle('active');
                            const level = item.dataset.level;

                            if (item.classList.contains('active')) {
                                this.activeFilters.levels.add(level);
                            } else {
                                this.activeFilters.levels.delete(level);
                            }

                            this.renderEntries();
                            this.updateStats();
                        });
                    });

                    // Language toggle
                    document.querySelectorAll('.lang-btn').forEach(btn => {
                        btn.addEventListener('click', async () => {
                            const newLang = btn.textContent.trim().toLowerCase();
                            if (newLang !== this.currentLang) {
                                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                                btn.classList.add('active');
                                this.currentLang = newLang;
                                this.allTags.clear();
                                await this.loadGlossary();
                            }
                        });
                    });

                    // Smooth scroll for alphabet
                    document.querySelectorAll('.alpha-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            if (!btn.classList.contains('disabled')) {
                                e.preventDefault();
                                const target = document.querySelector(btn.getAttribute('href'));
                                if (target) {
                                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            }
                        });
                    });

                    // Handle clicks on internal links
                    document.addEventListener('click', (e) => {
                        if (e.target.classList.contains('term-link') || e.target.classList.contains('related-link')) {
                            e.preventDefault();
                            const id = e.target.getAttribute('href').substring(1);
                            this.scrollToEntry(id);
                        }
                    });
                },

                // Scroll to and highlight an entry
                scrollToEntry(id) {
                    const element = document.getElementById(id);
                    if (element) {
                        // Update URL
                        history.pushState(null, null, `#${id}`);

                        // Expand the card
                        element.classList.add('expanded');

                        // Scroll with offset for fixed header
                        const headerOffset = 90;
                        const elementPosition = element.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                        window.scrollTo({
                            top: offsetPosition,
                            behavior: 'smooth'
                        });

                        // Highlight effect
                        element.style.boxShadow = '0 0 0 3px var(--primary-light)';
                        setTimeout(() => {
                            element.style.boxShadow = '';
                        }, 2000);
                    }
                },

                // Handle URL hash on page load
                handleUrlHash() {
                    if (window.location.hash) {
                        const id = window.location.hash.substring(1);
                        setTimeout(() => this.scrollToEntry(id), 300);
                    }
                },

                // Utility: capitalize first letter
                capitalizeFirst(str) {
                    return str.charAt(0).toUpperCase() + str.slice(1);
                }
            };

            // Initialize on page load
            document.addEventListener('DOMContentLoaded', () => {
                GlossaryApp.init();
            });
        </script>
    </body>
</html>
